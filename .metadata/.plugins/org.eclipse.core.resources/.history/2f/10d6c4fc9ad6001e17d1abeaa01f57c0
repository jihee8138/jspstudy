<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<!--
<style>
  .btn-wrap {
  }
</style>  
-->


</head>
<body>
<!-- enctype : form에서 보내는 데이터타입 -->
<form id="frm"
      method="POST"
      enctype="multipart/form-data">
      
  <div class="inp-wrap">
    <label for="title">제목</label>
    <input type="text" name="title" id="title">
  </div>      
  <div class="inp-wrap">
    <label for="file">첨부</label>
    <input type="file" name="file" id="file">
  </div> 
  <div class="btn-wrap">
    <button type="submit">전송</button>
    <button type="reset">다시입력</button>
  </div>     
  
</form>

<hr>
<!-- 페이지가 바뀌지 않고 작업이 일어난다 -> 비동기 작업 -->
<div id="preview">
  <h3>미리보기영역</h3>
</div>

<script>

  function isOversize(file) {
	  const limit = 1024 * 1024 * 5;
	 return file.size > limit;	  
  }
  
  function isImage(file) {
	  const contentType = file.type;
	  return contentType.startsWith('image');
	}
  
  function preview(file) {
	  const fileReader = new FileReader();
	  fileReader.readAsDataURL(file);
	  fileReader.addEventListener('load', (evt)=> {
		// console.log(evt.target);
		document.getElementById('preview').innerHTML = `<div><img src = "${evt.target.result}" width="50px"></div>`;
	  })
  }
  
  function checkFile(input) {
	 if(isOversize(inp.files[0])) {
		 alert('첨부 파일의 최대 크기는 5MB입니다.');
	   input.value = '';  // 첨부파일 지우기
	   return;		 
	 } 
	 if(!isImage(inp.files[0])) {  // 이미지가 아니면
		 alert('이미지 파일만 첨부할 수 있습니다.');
		 input.value = '';
		 return;
	 }	 
	 preview(inp.files[0]);
  }
	 
  document.getElementById('file').addEventListener('chage', (evt)=>{
	  checkFile(evt.target);
  });
   
</script>

</body>
</html>